---
title: "Adjusted Survival Curves"
subtitle: "(Cox Proportional Hazards Model)"
author: "Yuhui Cao"
date: "2025.03.11 Tue"
output: pdf_document
---

**Adjusted survival curves (LOVE SURVIVAL)** are used to visualize survival probabilities while controlling for covariates in a **Cox proportional hazards model**. 

Unlike traditional Kaplan-Meier curves, which display raw survival probabilities by group (e.g., treatment vs. control), adjusted survival curves take into account the effects of other variables in the model.

# Why Use Adjusted Survival Curves?
 - **Control for Confounding**: If age affects survival, but we want to compare treatment groups fairly, adjusted survival curves ensure differences are due to treatment, not age.
 - **More Accurate Interpretation**: Traditional Kaplan-Meier curves do not account for other covariates in the survival model.

```{r}
data <- data.frame(
  time      = c(5, 8, 12, 22, 40,    12, 20, 30, 35, 38, 40),
  status    = c(1, 1, 1,  1,  1,     1,  1,  1,  0,  0,  0),  # 1 = Event, 0 = Censored
  treatment = c(0, 0, 0,  0,  0,     1,  1,  1,  1,  1,  1),  # 0 = Control, 1 = Treatment
  age       = c(70,65,50, 40, 42,    72, 64, 55, 50, 30, 40)
)

# data
```

# How to Compute Adjusted Survival Curves in R
We can use the **survfit()** function with a Cox model to obtain these curves.

## Step 1: Fit the Cox Model
```{r}
library(survival)
cox_model <- coxph(Surv(time, status) ~ treatment + age, data = data)
summary(cox_model)
```

## Step 2: Compute Adjusted Survival Curves
### 1. Compute the mean age
We estimate survival probabilities while setting age to its mean value.
```{r}
mean_age <- mean(data$age)
mean_age
```

### 2. Create new dataset
```{r}
new_data <- data.frame(treatment = c(0, 1), age = mean_age)
new_data
```

### 3. Get adjusted survival estimates
```{r}
adjusted_fit <- survfit(cox_model, newdata = new_data)
adjusted_fit
```

## Step 3: Plot Adjusted Survival Curves
```{r}
library(survminer)  # Install if needed: install.packages("survminer")

ggsurvplot(adjusted_fit, data = data, 
           legend.labs = c("Control", "Treatment"),
           conf.int = TRUE, ggtheme = theme_minimal(),
           xlab = "Time", ylab = "Adjusted Survival Probability")

```

 - newdata = new_data: Ensures survival curves are adjusted for covariates.
 - conf.int = TRUE: Adds confidence intervals.
 - legend.labs: Labels the treatment groups.
 - theme_minimal(): A clean plot style.

# How to Interpret Adjusted Survival Curves
 - The curves show the probability of survival over time for **treatment vs. control**, assuming both groups had the **same average age**.
 - If the treatment group's curve is higher than the control group's, it suggests a survival benefit after adjusting for age.







